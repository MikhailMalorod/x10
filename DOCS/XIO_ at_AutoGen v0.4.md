# XIO: Консилиум экспертов на базе AutoGen v0.4 — философия, архитектура и функционал продукта

Версия: 2.1
Назначение: стратегический и инженерный документ, который фиксирует философию XIO, целевую ценность и полный функционал MVP/следующих этапов, опираясь на актуальную экосистему AutoGen v0.4 (Core, AgentChat, Studio) и применяя лучшие практики прототипирования, оркестрации и прод-безопасности.[^1]

***

## 1) Философия XIO

- Миссия: превратить совещания в управляемые консилиумы экспертов, где результатом всегда становятся проверяемые решения и реализуемые задачи, а не просто «обсуждения».
- Принцип «сквозного потока»: подготовка → обсуждение → фиксация решений → задачи → фоллоу‑ап. Каждый шаг автоматизируется мультиагентной оркестрацией.
- Мультиагентная ответственность: отдельные роли (Модератор, Доменные эксперты, Хронист, Интегратор) работают согласованно, а не монолитно; диалог движется по понятным правилам, с прозрачной очередностью и критериями завершения.
- Продуктовый реализм: XIO — прод‑приложение с безопасностью, управлением секретами, правами доступа, наблюдаемостью и идемпотентностью экспорта; AutoGen Studio используется как прототипер/референс UX, но не подменяет прод‑архитектуру.[^2][^1]
- Ценность, измеримая неделями: ≥70% встреч завершаются decision log + задачами; подготовка повестки занимает ≤7 минут; переход от «слова» к «задаче» происходит автоматически.

***

## 2) Ключевые сценарии (Core Use Cases)

A. Консилиум экспертов (приоритетный)

- Пользователь собирает команду ИИ‑экспертов, задаёт тему и критерии готовности решения.
- Агенты обсуждают альтернативы, выявляют риски/стоимость, сходятся в решении.
- Хронист оформляет decision log, Интегратор создаёт action items и экспортирует в Notion, а также запускает фоллоу‑апы в коммуникациях.

B. Маркетинг-аналитика (этап 2)

- Плюс интеграции с аналитикой/ads/почтой/календарём, прогнозные модули и план кампаний; всё проходит через тот же «сквозной поток» и создает задачи/решения.

Пилотные метрики успеха

- Консилиум: ≥70% сессий → decision log + 5–10 задач в Notion; среднее время до фиксации решения ≤15 минут.
- Маркетинг: подготовка повестки ≤7 минут; авто‑план кампаний и минимум один проверяемый прогноз по итогам встречи.

***

## 3) Архитектурные основы на AutoGen v0.4

Компоненты AutoGen

- AutoGen Studio: песочница/референс UX для декларативной сборки команд, стриминга и run control; используется для быстрых прототипов и как ориентир для UI XIO (но не как прод).[^2][^1]
- AgentChat: высокоуровневый API агентов и оркестрации (AssistantAgent, UserProxyAgent, GroupChat/Manager, speaker selection); основа логики XIO.[^1]
- Core (event-driven): фундамент для масштабируемых мультиагентных систем (событийная модель, ранны, обработка потоков); задает базу для асинхронности, стриминга и наблюдаемости.[^1]

Сущности XIO → AutoGen

- Agent → AssistantAgent (роль/промпт, модель, инструменты)
- System user → UserProxyAgent (инициация, исполнение кода в Docker, точки вмешательства)
- Team → GroupChat (состав и настройки по умолчанию)
- Meeting → GroupChatManager run (история, run control, метрики)
- ToolDefinition/ToolInstance → регистрируемые функции с JSON Schema параметров (подписи для ассистента, реальное исполнение через UserProxy)

Асинхронность и стриминг

- Взаимодействие через async‑вызовы, WebSockets поток сообщений/событий для UI модератора (playground‑подобный опыт).[^2][^1]
- Run control: pause/resume/stop раннов, смена настроек на лету, наблюдаемость.

Безопасность исполнения

- UserProxyAgent исполняет код только в Docker с ограничениями CPU/RAM/NET/timeout; логирование и маскирование секретов обязательны.

***

## 4) Оркестрация и политики

Оркестратор: GroupChatManager

- speaker_selection_method: round_robin/auto/random/custom.
- allow_repeat_speaker: гибкая реплика одного агента подряд.
- Custom selector и StateFlow/FSM: реализация политик качества:
    - минимум 2 альтернативы;
    - явное обоснование (rationale);
    - оценка рисков/стоимости/влияния;
    - эскалация при отсутствии консенсуса за N итераций;
    - проверка полноты перед фиксацией (решение ↔ задачи ↔ дедлайны).

Роли агентов

- Модератор: держит цель/тайминг/критерии качества, завершает темой суммарием.
- Доменные эксперты: углубленные ответы, альтернативы, оценки.
- Хронист (Scribe): структурирует решения, альтернативы, rationale.
- Интегратор: формирует action items, нормализует поля и экспортирует.

***

## 5) Инструменты и интеграции

Модель инструментов

- ToolDefinition: системная запись (code_identifier, JSON Schema параметров, returns, runtime_constraints, network_policy).
- ToolInstance: экземпляр пользователя (name/description/parameters), привязка к owner, scope (agent/team/global), permissions (RBAC), rate_limits, связь с агентами/командой.
- Регистрация:
    - ассистенту — подписи (сигнатуры) для генерации корректного кода;
    - UserProxy — реальные callable для исполнения (с подстановкой параметров ToolInstance) в Docker‑песочнице.

MVP‑набор

- Notion: create_decision_log, create_action_item (идемпотентно по meeting_id).
- Коммуникации: Slack/Telegram — резюме встречи, фоллоу‑апы.
- Браузинг/добыча контента: Crawl4AI/Browser‑use — по необходимости для экспертов.
- RAG: ChromaDB для семантического извлечения релевантного контекста.
- Этап 2+: трекеры (Jira/Linear), календарь/почта, CRM.

***

## 6) Хранилища и контекст

- Истина: PostgreSQL — полная история сообщений, конфиги, артефакты/метрики.
- Кеш: Redis — живое состояние ранна, локальный контекст.
- Векторное: ChromaDB — индекс повесток/фрагментов истории/документов.
- Извлечение контекста: короткая память последних сообщений + релевантные фрагменты из ChromaDB + структурные данные повестки/решений.
- Контроль стоимости: лимиты токенов, обрезка, метрики стоимости/токенов на run.

***

## 7) Наблюдаемость и модерация (референс UX из Studio)

- Стриминг сообщений агентов и статусов инструментов (WS) с унифицированными событиями `StreamEvent`:
  - `participant_updated`, `chat_message`, `tool_call` (started/progress/finished/error), `artifact`, `run_status`.
- Граф переходов контроля (transition graph): кто говорит/почему выбран, какие условия выполнены — прозрачность и объяснимость для модератора.[^2]
- Панель модератора: ручной handoff, кнопки «запрос альтернативы/рисков», pause/resume/stop, таймбоксы, parking lot.
- Метрики качества: % встреч с артефактами, среднее время до решения, конверсия «решение→исполнение», правки после рассылки.
- Логирование: трассировка раннов/сообщений/инструментов, маскирование секретов, корреляция run_id/meeting_id/agent_id.

***

## 8) UX настроек совещания и чатовый интерфейс

До встречи

- Конструктор повестки: шаблоны, сбор контекста, приоритеты и таймбоксы.
- Состав/веса экспертов, политика консенсуса, критерии завершения.
- Интеграции и права доступа; предпросмотр и чистка собранных данных.

Во время встречи (Chat UI)

- Левая панель: участники (роль, speaking/next, tool badges), контекстные действия модератора (handoff, request_alt, request_risk).
- Правая лента: сообщения (markdown, mentions), треды инструментов (masked args, прогресс, логи), карточки артефактов (Decision Log/Task) с ссылками.
- Виртуализация ленты, lazy‑load истории, стабильные WS‑соединения (reconnect/backoff/heartbeat).

После встречи

- Decision log (Notion), задачи (Notion DB), рассылки в Slack/Telegram.
- Фоллоу‑ап: проверка выполнения через N дней, запрос корректности фиксации.

***

## 9) Безопасность и соответствие

- Docker‑песочница для кода: лимиты CPU/RAM/NET/timeout, отдельные образы.
- Секреты: шифрование, хранение в защищённых полях, маскирование в логах.
- Политики приватности: управление уровнями доступа к встречам/артефактам.
- Контроль экспорта: идемпотентность по meeting_id, аудит действий.

***

## 10) Масштабирование и исполнение

- Backend: FastAPI (async) + очереди Celery/Redis/RabbitMQ для запусков run.
- Горизонтальное масштабирование: воркеры run, sticky routing по meeting_id, лимиты на одновременные run и backpressure.
- Версионирование конфигов: фиксация версии агента/команды на момент run (auditability).

***

## 11) API и контракты (MVP + чатовый UX)

Meetings

- POST /api/v1/meetings — создать Meeting (team_id, topic, config_override).
- POST /api/v1/meetings/{id}/start — запустить run (async job, вернуть run_id).
- WS /api/v1/meetings/{id}/stream — поток `StreamEvent` (participant_updated/chat_message/tool_call/artifact/run_status).
- POST /api/v1/meetings/{id}/control — управление run (pause/resume/stop, handoff, request_alt, request_risk).
- GET /api/v1/meetings/{id}/messages?page=… — пагинация истории ленты.
- GET /api/v1/meetings/{id}/participants — состав и статусы участников.
- POST /api/v1/meetings/{id}/messages — (опц.) пользовательские комментарии/вопросы.

Tools

- GET /api/v1/tools/available — идентификаторы из системного реестра.
- CRUD ToolDefinition/ToolInstance — JSON Schema для динамического UI; scopes agent/team/global; RBAC.

Integrations

- POST /api/v1/integrations/notion/decision-log — создать страницу.
- POST /api/v1/integrations/notion/tasks — создать задачи списком.

***

## 12) План релиза (3–5 дней до первого результата)

День 1: Оркестрация и роли

- GroupChat/Manager, роли (Moderator, Expert A/B, Scribe, Integrator), round_robin, allow_repeat_speaker.
- Заглушки Notion-инструментов, WS‑стриминг (брокер + сериализаторы событий).

День 2: Хронист и интегратор

- Структуры decision log и нормализатор action items.
- Unit‑тесты на извлечение задач из протокола; REST `/messages` и `/participants`.

День 3: Интеграция Notion

- create_decision_log, create_action_item; идемпотентность по meeting_id.
- Возврат ссылок/ID в UI; карточки артефактов.

День 4: Панель модератора (минимум)

- Стрим реплик, текущий/следующий спикер, таймеры, кнопки pause/stop; запрос альтернативы/рисков.
- Сквозной тест «консилиум → Notion → UI артефакты».

День 5: Метрики и полировка

- % успешных встреч, время до решения, количество задач/встречу.
- Демо‑скрипт/реплей ранна; виртуализация ленты и оптимизация WS.

***

## 13) Совместимость с AutoGen Studio (импорт/референс)

- Импорт декларативных конфигов из Studio/Gallery в XIO (конвертер Studio JSON → XIO Team/Agent/ToolDefinition).
- Вдохновиться Playground‑UX: live‑стрим, run control, граф переходов; реализовать это в XIO‑панели модератора с прод‑требованиями безопасности.[^2]
- Экспорт команды в исполняемый рецепт (Python) для отладки; основная эксплуатация — через XIO конфиги и AutoGenService.

***

## 14) Дорожная карта расширений

Этап 2

- Трекеры (Jira/Linear), календарь/почта; расширенные политики консенсуса; RAG‑плейбуки по доменам.

Этап 3

- Realtime‑агенты (голос/мультимодальность), WebRTC‑сессии, запись и индексирование медиа.

Этап 4

- Авто‑подготовка повестки из почты/трекеров/CRM; A/B‑тесты стилей модерации; «галерея» доменных шаблонов XIO.

Этап 5

- Расширенный контроль стоимости и токенов per run; мультимодельные конфигурации, MTTD/MTTR метрики для инцидент‑ревью.

***

## 15) Что XIO делает «иначе»

- От «чат‑протоколов» к «решениям и задачам»: всегда материализация результата в Notion/трекерах.
- От «LLM‑магии» к «управляемым политиками» консилиумам: явные критерии качества и финализации.
- От «прототипов» к «продукту»: безопасность, секреты, права, наблюдаемость и идемпотентность — не опциональны.

***

Готовность к реализации подтверждена: AutoGen v0.4 предоставляет AgentChat и Core‑механизмы, AutoGen Studio — ориентир для UX прототипирования и совместимых конфигураций; XIO использует эти возможности для построения прод‑сервиса с управляемыми консилиумами, прозрачной оркестрацией и предсказуемыми результатами.[^1][^2]

[^1]: https://microsoft.github.io/autogen/stable/index.html